#!/usr/bin/env bash

set -o errexit

phpbrew_install_init() {
  export phpbrew_prefix phpbrew_os
}

phpbrew_install_set_defaults() {
  if [[ "$UID" = 0 ]]; then
    phpbrew_prefix="/usr/local"
  else
    phpbrew_prefix="${HOME/\/$/}"
  fi
}

phpbrew_check_system() {
  local supported_os

  if [[ $(command -v lsb_release) ]]; then
    phpbrew_os=$(lsb_release -si)
  else
    if [[ $(command -v uname) ]]; then
      phpbrew_os=$(uname)
    else
      phpbrew_os="unknown"
    fi
  fi

  supported_os=(Ubuntu Darwin)
  if [[ ! "${supported_os[@]}" =~ "$phpbrew_os" ]]; then
    return 1
  fi
}

phpbrew_install_dependencies() {
  case "$phpbrew_os" in
    "Darwin")
      if [[ $(command -v port) ]]
      then
        port install curl automake autoconf icu depof:php5 depof:php5-gd mcrypt re2c gettext openssl
      else
        if [[ $(command -v brew) ]]
        then
          brew install automake autoconf curl pcre re2c mhash libtool icu4c gettext jpeg libxml2 mcrypt gmp libevent
          brew link icu4c
        else
          return 1
        fi
      fi
      ;;
    "Ubuntu")
      sudo apt-get build-dep php5
      sudo apt-get install -y php5 php5-dev php-pear autoconf automake curl build-essential libxslt1-dev re2c libxml2 libxml2-dev php5-cli bison libbz2-dev libreadline-dev
      ;;
  esac
}
